<!DOCTYPE html>
<html lang="pt-br" style="font-size: 16px;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{% block title %}Lumina Beauty{% endblock %}</title>
    
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/Logo_Lumina-removebg-preview.png') }}">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Quicksand", sans-serif;
            background-color: var(--light-bg);
        }


        /* Container fixo que fica sobre tudo (z-index alto) */
        #flash-overlay-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999999;
            width: 350px;
            max-width: 90vw;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        /* O bal√£o individual */
        .alert-floating {
            pointer-events: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: none;
            border-left: 5px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            opacity: 0.98;
            animation: slideInFloat 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            position: relative;
            overflow: hidden;
            padding-bottom: 14px;
        }

        /* Anima√ß√£o de entrada */
        @keyframes slideInFloat {
            from {
                opacity: 0;
                transform: translateX(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        /* Anima√ß√£o de sa√≠da */
        @keyframes slideOutFloat {
            from {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateX(50px) scale(0.9);
            }
        }

        /* Barra de progresso */
        .alert-progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #f9f0f2 20%, #e8b8c2 100%);
            animation: progressBar 5s linear forwards;
            border-radius: 2px;
        }

        /* Anima√ß√£o da barra */
        @keyframes progressBar {
            from {
                width: 0%;
            }
            to {
                width: 100%;
            }
        }

        /* Estado de sa√≠da */
        .alert-floating.closing {
            animation: slideOutFloat 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Teste - container de exemplos */
        .test-container {
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        
        
    </style>
</head>
<body id="page-top">

    <div id="flash-overlay-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-floating alert-dismissible fade show bg-white" role="alert">
                        {% if category == 'success' %}<i class="bi bi-check-circle-fill text-success me-2"></i>{% endif %}
                        {% if category == 'danger' %}<i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>{% endif %}
                        {% if category == 'warning' %}<i class="bi bi-exclamation-circle-fill text-warning me-2"></i>{% endif %}
                        {% if category == 'info' %}<i class="bi bi-info-circle-fill text-info me-2"></i>{% endif %}
                        
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <a href="#main-content" class="skip-to-content">Pular para o Conte√∫do</a>
    
    <nav class="navbar navbar-light bg-light sticky-top shadow-sm px-3 app-header">
        
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuOffcanvas" aria-controls="menuOffcanvas">
            <span class="navbar-toggler-icon"></span>
        </button>

        <a class="navbar-brand-centered" href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='images/lumina.png') }}" alt="Lumina Beauty Logo" height="60">
            Lumina Beauty
        </a>

        <div class="navbar-right-cluster d-flex align-items-center gap-3">
            
            <a class="nav-link position-relative" href="{{ url_for('ver_carrinho') }}" title="Meu Carrinho">
                <i class="bi bi-bag fs-4"></i>
                {% if total_itens_carrinho > 0 %}
                    <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle" style="font-size: 0.7rem; padding: 4px 6px;">
                        {{ total_itens_carrinho }}
                    </span>
                {% endif %}
            </a>

            {% if user_info.logado %}
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarUserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="Minha Conta">
                        <i class="bi bi-person-circle fs-4"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarUserDropdown">
                        <li><span class="dropdown-header">Ol√°, {{ user_info.nome }}</span></li>
                        <li><a class="dropdown-item" href="{{ url_for('minha_conta') }}">Minha Conta</a></li>
                        {% if user_info.papel == 'admin' %}
                            <li><a class="dropdown-item" href="{{ url_for('admin_produtos') }}">Painel Admin</a></li>
                        {% endif %}
                        <li>
                            <a class="dropdown-item" href="{{ url_for('meus_pedidos') }}">
                                 Meus Pedidos
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}">Sair (Logout)</a></li>
                    </ul>
                </div>
            {% else %}
                <a class="nav-link" href="{{ url_for('login') }}" title="Login / Registrar">
                    <i class="bi bi-person fs-4"></i>
                </a>
            {% endif %}

        </div>
    </nav>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="menuOffcanvas" aria-labelledby="menuOffcanvasLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="menuOffcanvasLabel">Lumina Beauty</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('index') }}">
                        <i class="bi bi-house-door-fill me-2"></i> Home
                    </a>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="offcanvasCategorias" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-tag-fill me-2"></i> Categorias
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="offcanvasCategorias">
                        <li><a class="dropdown-item" href="{{ url_for('categoria_produtos', nome_categoria='rosto') }}">Rosto</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('categoria_produtos', nome_categoria='olhos') }}">Olhos</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('categoria_produtos', nome_categoria='labios') }}">L√°bios</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('categoria_produtos', nome_categoria='skincare') }}">Skincare</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('categoria_produtos', nome_categoria='pinceis') }}">Pinc√©is</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('categoria_produtos', nome_categoria='kits') }}">Kits</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('quiz') }}">
                        <i class="bi bi-patch-question-fill me-2"></i> Quiz de Maquiagem
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('contato') }}">
                        <i class="bi bi-envelope-fill me-2"></i> Contato
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('novidades') }}">
                        <i class="bi bi-star-fill me-2"></i> Novidades
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('promocoes') }}">
                        <i class="bi bi-percent me-2"></i> Promo√ß√µes
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('avaliacoes') }}">
                        <i class="bi bi-chat-right-quote me-2"></i> Avalia√ß√µes
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('sobre') }}">
                        <i class="bi bi-gem me-2"></i> Sobre
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-content-area flex-grow-1 p-0" id="main-content">
        {% block content %}{% endblock %}
    </div>

    

<!-- SCROLL TO TOP BUTTON -->


    <button class="chatbot-toggler" id="chatbot-toggler">
        <span class="bi bi-chat-dots-fill"></span>
        <span class="bi bi-x-lg"></span>
    </button>

    <div class="chatbot">
        <header>
            <h2>Lumina Bot</h2>
            <span class="close-btn material-symbols-outlined">close</span>
        </header>
        <ul class="chatbox" id="chatbox">
            <li class="chat incoming">
                <span class="bi bi-robot"></span>
                <p>Ol√°! üëã Bem-vinda √† Lumina Beauty. Como posso ajudar voc√™ hoje?</p>
            </li>
        </ul>
        <div class="chat-input">
            <textarea id="chat-textarea" placeholder="Escreva uma mensagem..." required></textarea>
            <span id="send-btn" class="bi bi-send-fill"></span>
        </div>
    </div>

    <div class="accessibility-menu" id="acc-menu">
        <h5>Acessibilidade</h5>
        
        <div class="acc-group">
            <h6>Tamanho da Fonte</h6>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-acc" id="acc-font-decrease" title="Diminuir Fonte">
                    <i class="bi bi-zoom-out"></i> A-
                </button>
                <button type="button" class="btn btn-acc" id="acc-font-increase" title="Aumentar Fonte">
                    <i class="bi bi-zoom-in"></i> A+
                </button>
            </div>
        </div>
        
        <div class="acc-group">
            <h6>Ajustes de Tela</h6>
            <div class="d-grid gap-2">
                <button type="button" class="btn btn-acc" id="acc-high-contrast" data-acc-toggle="acc-high-contrast">
                    <i class="bi bi-circle-half"></i> Alto Contraste
                </button>
                <button type="button" class="btn btn-acc" id="acc-grayscale" data-acc-toggle="acc-grayscale">
                    <i class="bi bi-palette-fill"></i> Escala de Cinza
                </button>
                 <button type="button" class="btn btn-acc" id="acc-big-cursor" data-acc-toggle="acc-big-cursor">
                    <i class="bi bi-cursor-fill"></i> Cursor Maior
                </button>
            </div>
        </div>

        <div class="acc-group">
            <h6>Ajustes de Conte√∫do</h6>
            <div class="d-grid gap-2">
                <button type="button" class="btn btn-acc" id="acc-underline-links" data-acc-toggle="acc-underline-links">
                    <i class="bi bi-link-45deg"></i> Sublinhar Links
                </button>
                <button type="button" class="btn btn-acc" id="acc-highlight-links" data-acc-toggle="acc-highlight-links">
                    <i class="bi bi-highlighter"></i> Destacar Links
                </button>
                <button type="button" class="btn btn-acc" id="acc-dyslexia" data-acc-toggle="acc-dyslexia-friendly">
                    <i class="bi bi-fonts"></i> Fonte Amig√°vel
                </button>
                <button type="button" class="btn btn-acc" id="acc-stop-animations" data-acc-toggle="acc-stop-animations">
                    <i class="bi bi-pause-circle"></i> Parar Anima√ß√µes
                </button>
            </div>
        </div>
        
        <button type="button" class="btn btn-acc-reset w-100 mt-2" id="acc-reset">
            <i class="bi bi-arrow-counterclockwise me-2"></i> Resetar
        </button>
    </div>
    
    <button class="accessibility-widget" id="acc-widget" title="Acessibilidade" aria-controls="acc-menu" aria-expanded="false">
        <i class="bi bi-universal-access"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
    
    // ==========================================
    // 1. WIDGET DE ACESSIBILIDADE
    // ==========================================
    
    const accWidget = document.getElementById('acc-widget');
    const accMenu = document.getElementById('acc-menu');
    const html = document.documentElement;
    const body = document.body;
    
    const defaultFontSize = 16;
    let currentFontSize = defaultFontSize;

    accWidget.addEventListener('click', () => {
        accMenu.classList.toggle('active');
        accWidget.setAttribute('aria-expanded', accMenu.classList.contains('active'));
    });

    function setFontSize(size) {
        currentFontSize = size;
        html.style.fontSize = size + 'px';
        localStorage.setItem('acc_fontSize', size);
        
        document.getElementById('acc-font-increase').disabled = currentFontSize >= 20;
        document.getElementById('acc-font-decrease').disabled = currentFontSize <= 14;
    }

    function toggleBodyClass(className, buttonId) {
        body.classList.toggle(className);
        const isActive = body.classList.contains(className);
        localStorage.setItem(className, isActive);
        
        if (buttonId) {
            const btn = document.getElementById(buttonId);
            if (isActive) {
                btn.classList.add('active');
                btn.setAttribute('aria-pressed', 'true');
            } else {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            }
        }
        
        if (className === 'acc-stop-animations') {
            toggleCarousel(isActive);
        }
    }

    function toggleCarousel(isPaused) {
        const carouselEl = document.getElementById('heroCarousel');
        if (carouselEl) {
            try {
                const carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl);
                if (isPaused) {
                    carousel.pause();
                } else {
                    carousel.cycle();
                }
            } catch (e) {
                console.warn("N√£o foi poss√≠vel controlar o carrossel: ", e);
            }
        }
    }

    function initAccessibility() {
        const savedSize = parseInt(localStorage.getItem('acc_fontSize'), 10);
        if (savedSize && !isNaN(savedSize)) {
            setFontSize(savedSize);
        } else {
            setFontSize(defaultFontSize);
        }

        const toggles = {
            'acc-high-contrast': 'acc-high-contrast',
            'acc-grayscale': 'acc-grayscale',
            'acc-underline-links': 'acc-underline-links',
            'acc-highlight-links': 'acc-highlight-links',
            'acc-dyslexia-friendly': 'acc-dyslexia',
            'acc-stop-animations': 'acc-stop-animations',
            'acc-big-cursor': 'acc-big-cursor'
        };
        
        for (const cls in toggles) {
            if (localStorage.getItem(cls) === 'true') {
                body.classList.add(cls);
                const btn = document.getElementById(toggles[cls]);
                if (btn) {
                    btn.classList.add('active');
                    btn.setAttribute('aria-pressed', 'true');
                }
            }
        }
        
        if (body.classList.contains('acc-stop-animations')) {
            setTimeout(() => toggleCarousel(true), 500);
        }
    }

    document.getElementById('acc-font-increase').addEventListener('click', function() {
        if (currentFontSize < 20) setFontSize(currentFontSize + 2);
    });

    document.getElementById('acc-font-decrease').addEventListener('click', function() {
        if (currentFontSize > 14) setFontSize(currentFontSize - 2);
    });

    document.getElementById('acc-high-contrast').addEventListener('click', () => 
        toggleBodyClass('acc-high-contrast', 'acc-high-contrast'));
    
    document.getElementById('acc-grayscale').addEventListener('click', () => 
        toggleBodyClass('acc-grayscale', 'acc-grayscale'));
    
    document.getElementById('acc-underline-links').addEventListener('click', () => 
        toggleBodyClass('acc-underline-links', 'acc-underline-links'));
    
    document.getElementById('acc-highlight-links').addEventListener('click', () => 
        toggleBodyClass('acc-highlight-links', 'acc-highlight-links'));
    
    document.getElementById('acc-dyslexia').addEventListener('click', () => 
        toggleBodyClass('acc-dyslexia-friendly', 'acc-dyslexia'));
    
    document.getElementById('acc-stop-animations').addEventListener('click', () => 
        toggleBodyClass('acc-stop-animations', 'acc-stop-animations'));
    
    document.getElementById('acc-big-cursor').addEventListener('click', () => 
        toggleBodyClass('acc-big-cursor', 'acc-big-cursor'));

    document.getElementById('acc-reset').addEventListener('click', function() {
        localStorage.clear();
        location.reload();
    });

    initAccessibility();

    // ==========================================
    // 2. CHATBOT INTELIGENTE
    // ==========================================
    
    const chatbotToggler = document.getElementById('chatbot-toggler');
    const chatbox = document.getElementById('chatbox');
    const chatInput = document.getElementById('chat-textarea');
    const sendChatBtn = document.getElementById('send-btn');

    // Base de produtos (simula√ß√£o)
    const produtos = [
        { id: 1, nome: "P√≥ Compacto Transl√∫cido", preco: 119.90, categoria: "rosto" },
        { id: 2, nome: "Batom L√≠quido Cremoso", preco: 95.00, categoria: "labios" },
        { id: 3, nome: "L√°pis de Olho Retr√°til", preco: 59.90, categoria: "olhos" },
        { id: 4, nome: "Kit Completo Lumina", preco: 499.90, categoria: "kits" },
        { id: 5, nome: "S√©rum Hidratante", preco: 189.90, categoria: "skincare" },
        { id: 6, nome: "Kit de Pinc√©is Profissional", preco: 299.90, categoria: "pinceis" }
    ];

    // Op√ß√µes do menu principal
    const botOptions = [
        { text: "üõçÔ∏è Ver Produtos", action: "produtos" },
        { text: "üì¶ Status do Pedido", action: "status" },
        { text: "üíÑ Quiz de Maquiagem", action: "quiz" },
        { text: "üí¨ Falar com Humano", action: "whatsapp" },
        { text: "‚ùì D√∫vidas Frequentes", action: "faq" }
    ];

    // Criar mensagem de chat
    const createChatLi = (message, className) => {
        const chatLi = document.createElement("li");
        chatLi.classList.add("chat", className);
        let content = className === "outgoing" 
            ? `<p></p>` 
            : `<span class="bi bi-robot"></span><p></p>`;
        chatLi.innerHTML = content;
        chatLi.querySelector("p").innerHTML = message; // Mudei para innerHTML para aceitar HTML
        return chatLi;
    }

    // Verificar se est√° logado
    const isUserLoggedIn = () => {
        // Verifica se existe o elemento do usu√°rio no navbar
        return document.getElementById('navbarUserDropdown') !== null;
    }

    // Criar card de produto
    const createProductCard = (produto) => {
        const card = document.createElement("div");
        card.classList.add("chat-product-card");
        card.innerHTML = `
            <div class="product-info">
                <div class="product-name">${produto.nome}</div>
                <div class="product-category">${getCategoryName(produto.categoria)}</div>
                <div class="product-price">R$ ${produto.preco.toFixed(2).replace('.', ',')}</div>
            </div>
            <div class="product-actions">
                <button class="btn-product-action btn-view" onclick="window.location.href='/produto/${produto.id}'">
                    <i class="bi bi-eye"></i> Ver Detalhes
                </button>
                <button class="btn-product-action btn-buy" data-produto-id="${produto.id}">
                    <i class="bi bi-cart-plus"></i> Adicionar
                </button>
            </div>
        `;
        return card;
    }

    // Obter nome da categoria
    const getCategoryName = (categoria) => {
        const nomes = {
            'rosto': 'Rosto',
            'labios': 'L√°bios',
            'olhos': 'Olhos',
            'kits': 'Kit Completo',
            'skincare': 'Skincare',
            'pinceis': 'Pinc√©is'
        };
        return nomes[categoria] || categoria;
    }

    // Adicionar op√ß√µes (bot√µes de menu)
    const appendOptions = () => {
        const optionsDiv = document.createElement("div");
        optionsDiv.classList.add("chat-options", "chat", "incoming");

        botOptions.forEach(opt => {
            const btn = document.createElement("button");
            btn.classList.add("chat-btn");
            btn.textContent = opt.text;
            btn.onclick = () => handleOption(opt.action);
            optionsDiv.appendChild(btn);
        });
        chatbox.appendChild(optionsDiv);
        chatbox.scrollTo(0, chatbox.scrollHeight);
    }

    // Lidar com op√ß√µes do menu
    const handleOption = (action) => {
        // Limpa op√ß√µes anteriores
        document.querySelectorAll('.chat-options').forEach(el => el.remove());
        
        chatbox.appendChild(createChatLi(`üìå ${getActionText(action)}`, "outgoing"));

        setTimeout(() => {
            switch(action) {
                case "produtos":
                    showProducts();
                    break;
                case "status":
                    showStatus();
                    break;
                case "quiz":
                    showQuiz();
                    break;
                case "whatsapp":
                    openWhatsApp();
                    break;
                case "faq":
                    showFAQ();
                    break;
            }
        }, 400);
    }

    // Obter texto da a√ß√£o
    const getActionText = (action) => {
        const texts = {
            "produtos": "Ver Produtos",
            "status": "Status do Pedido",
            "quiz": "Quiz de Maquiagem",
            "whatsapp": "Falar com Humano",
            "faq": "D√∫vidas Frequentes"
        };
        return texts[action] || action;
    }

    // Mostrar produtos
    const showProducts = () => {
        chatbox.appendChild(createChatLi("üíÑ Aqui est√£o nossos produtos em destaque:", "incoming"));
        
        produtos.forEach((produto, index) => {
            setTimeout(() => {
                const productCard = createProductCard(produto);
                const li = document.createElement("li");
                li.classList.add("chat", "incoming", "product-message");
                li.appendChild(productCard);
                chatbox.appendChild(li);
                chatbox.scrollTo(0, chatbox.scrollHeight);
                
                // Adicionar evento de compra
                li.querySelector('.btn-buy').addEventListener('click', (e) => {
                    const produtoId = parseInt(e.currentTarget.getAttribute('data-produto-id'));
                    handlePurchase(produtoId);
                });
            }, index * 200);
        });

        setTimeout(() => {
            if (!isUserLoggedIn()) {
                chatbox.appendChild(createChatLi(
                    "üí° <strong>Dica:</strong> Fa√ßa <a href='/login' class='chat-link'>login</a> para adicionar produtos ao carrinho!",
                    "incoming"
                ));
            }
            chatbox.appendChild(createChatLi("Posso ajudar com algo mais?", "incoming"));
            appendOptions();
        }, produtos.length * 200 + 600);
    }

    // Lidar com compra
    const handlePurchase = (produtoId) => {
        // Verifica se est√° logado
        if (!isUserLoggedIn()) {
            chatbox.appendChild(createChatLi("Quero adicionar este produto ao carrinho", "outgoing"));
            
            setTimeout(() => {
                chatbox.appendChild(createChatLi(
                    "üîí Ops! Voc√™ precisa fazer <a href='/login' class='chat-link'><strong>login</strong></a> para adicionar produtos ao carrinho.<br><br>" +
                    "Ainda n√£o tem conta? <a href='/registrar' class='chat-link'><strong>Cadastre-se aqui!</strong></a>",
                    "incoming"
                ));
                chatbox.scrollTo(0, chatbox.scrollHeight);
                setTimeout(() => appendOptions(), 2000);
            }, 600);
            return;
        }

        const produto = produtos.find(p => p.id === produtoId);
        if (!produto) return;

        // Desabilita o bot√£o temporariamente
        const btn = document.querySelector(`[data-produto-id="${produtoId}"]`);
        if (btn) {
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Aguarde...';
        }

        chatbox.appendChild(createChatLi(`Adicionar ao carrinho: ${produto.nome}`, "outgoing"));
        
        // Faz a requisi√ß√£o
        fetch(`/adicionar_carrinho/${produtoId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'quantidade=1'
        })
        .then(response => {
            if (!response.ok) throw new Error('Erro ao adicionar');
            return response;
        })
        .then(() => {
            setTimeout(() => {
                chatbox.appendChild(createChatLi(
                    `‚úÖ <strong>${produto.nome}</strong> foi adicionado ao carrinho!<br><br>` +
                    `üí∞ Valor: <strong>R$ ${produto.preco.toFixed(2).replace('.', ',')}</strong><br><br>` +
                    `<a href="/carrinho" class="chat-link-button">üõí Ver Carrinho</a> ` +
                    `<a href="/produto/${produto.id}" class="chat-link-button">üì¶ Ver Detalhes</a>`,
                    "incoming"
                ));
                chatbox.scrollTo(0, chatbox.scrollHeight);
                
                // Reabilita o bot√£o
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="bi bi-check2"></i> Adicionado!';
                    setTimeout(() => {
                        btn.innerHTML = '<i class="bi bi-cart-plus"></i> Adicionar';
                    }, 3000);
                }
                
                // Atualiza badge do carrinho (sem reload)
                updateCartBadge();
                
                setTimeout(() => {
                    chatbox.appendChild(createChatLi("Deseja continuar comprando?", "incoming"));
                    appendOptions();
                }, 2000);
            }, 600);
        })
        .catch(err => {
            console.error("Erro ao adicionar ao carrinho:", err);
            chatbox.appendChild(createChatLi(
                "‚ùå Desculpe, ocorreu um erro ao adicionar o produto. Tente novamente.",
                "incoming"
            ));
            if (btn) {
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-cart-plus"></i> Adicionar';
            }
            setTimeout(() => appendOptions(), 2000);
        });
    }

    // Atualizar badge do carrinho (sem reload)
    const updateCartBadge = () => {
        const badge = document.querySelector('.navbar-right-cluster .badge');
        if (badge) {
            const currentCount = parseInt(badge.textContent) || 0;
            badge.textContent = currentCount + 1;
            
            // Anima√ß√£o de destaque
            badge.style.transform = 'scale(1.3)';
            setTimeout(() => {
                badge.style.transform = 'scale(1)';
            }, 300);
        }
    }

    // Mostrar status
    const showStatus = () => {
        chatbox.appendChild(createChatLi(
            "Para verificar o status do seu pedido, por favor fa√ßa login e acesse <a href='/meus_pedidos' class='chat-link'>Meus Pedidos</a>.",
            "incoming"
        ));
        setTimeout(() => appendOptions(), 1500);
    }

    // Mostrar quiz
    const showQuiz = () => {
        chatbox.appendChild(createChatLi(
            "‚ú® Temos um quiz incr√≠vel para descobrir a maquilhagem ideal para voc√™!<br><br>" +
            "<a href='/quiz' class='chat-link'>üéØ Fazer o Quiz Agora</a>",
            "incoming"
        ));
        setTimeout(() => appendOptions(), 1500);
    }

    // Abrir WhatsApp
    const openWhatsApp = () => {
    // Remove op√ß√µes anteriores
    document.querySelectorAll('.chat-options, .whatsapp-options').forEach(el => el.remove());
    
    // Mensagem de boas-vindas
    chatbox.appendChild(createChatLi(
        "üí¨ <strong>Central de Atendimento WhatsApp</strong><br><br>" +
        "Nossa equipe est√° pronta para ajudar voc√™! üòä<br>" +
        "Escolha o departamento desejado:",
        "incoming"
    ));
    
    setTimeout(() => {
        const whatsappOptionsDiv = document.createElement("div");
        whatsappOptionsDiv.classList.add("whatsapp-options", "chat", "incoming");
        
        const whatsappOptions = [
            { 
                icon: "üì¶", 
                text: "D√∫vidas sobre Pedido", 
                message: "Ol√°! Preciso de ajuda com meu pedido na Lumina Beauty. Gostaria de falar com o departamento de pedidos.",
                department: "Pedidos"
            },
            { 
                icon: "üõçÔ∏è", 
                text: "Informa√ß√µes de Produto", 
                message: "Ol√°! Gostaria de saber mais informa√ß√µes sobre os produtos da Lumina Beauty. Podem me ajudar?",
                department: "Produtos"
            },
            { 
                icon: "üöö", 
                text: "Rastreamento de Entrega", 
                message: "Ol√°! Gostaria de rastrear minha entrega da Lumina Beauty. Podem me informar o status?",
                department: "Log√≠stica"
            },
            { 
                icon: "üí≥", 
                text: "Formas de Pagamento", 
                message: "Ol√°! Tenho d√∫vidas sobre formas de pagamento na Lumina Beauty. Podem me ajudar?",
                department: "Financeiro"
            },
            { 
                icon: "üîÑ", 
                text: "Troca ou Devolu√ß√£o", 
                message: "Ol√°! Preciso de ajuda com troca/devolu√ß√£o de um produto da Lumina Beauty.",
                department: "P√≥s-Venda"
            },
            { 
                icon: "üíÑ", 
                text: "Consultoria de Beleza", 
                message: "Ol√°! Gostaria de uma consultoria de beleza personalizada da Lumina Beauty.",
                department: "Consultoria"
            },
            { 
                icon: "‚ùì", 
                text: "Outro Assunto", 
                message: "Ol√°! Preciso falar com o atendimento da Lumina Beauty sobre outro assunto.",
                department: "Geral"
            }
        ];
        
        whatsappOptions.forEach((opt, index) => {
            setTimeout(() => {
                const btn = document.createElement("button");
                btn.classList.add("whatsapp-btn");
                btn.innerHTML = `
                    <span class="whatsapp-btn-icon">${opt.icon}</span>
                    <span class="whatsapp-btn-text">
                        <strong>${opt.text}</strong>
                        <small>Dep. ${opt.department}</small>
                    </span>
                    <i class="bi bi-arrow-right-short whatsapp-btn-arrow"></i>
                `;
                
                btn.onclick = () => handleWhatsAppClick(opt);
                whatsappOptionsDiv.appendChild(btn);
                
                // Anima√ß√£o de entrada
                btn.style.animation = 'slideInRight 0.3s ease forwards';
                
                chatbox.scrollTo(0, chatbox.scrollHeight);
            }, index * 100); // Delay progressivo
        });
        
        chatbox.appendChild(whatsappOptionsDiv);
        chatbox.scrollTo(0, chatbox.scrollHeight);
        
        // Adiciona nota de hor√°rio de atendimento
        setTimeout(() => {
            chatbox.appendChild(createChatLi(
                "‚è∞ <small>Hor√°rio de atendimento: Segunda a Sexta, 9h √†s 18h</small>",
                "incoming"
            ));
            chatbox.scrollTo(0, chatbox.scrollHeight);
        }, whatsappOptions.length * 100 + 500);
        
    }, 800);
}

// Fun√ß√£o para lidar com clique nos bot√µes do WhatsApp
const handleWhatsAppClick = (option) => {
    // Remove op√ß√µes do WhatsApp
    document.querySelectorAll('.whatsapp-options').forEach(el => el.remove());
    
    // Mostra a escolha do usu√°rio
    chatbox.appendChild(createChatLi(
        `${option.icon} ${option.text}`, 
        "outgoing"
    ));
    
    // Anima√ß√£o de "digitando"
    setTimeout(() => {
        const typingDiv = document.createElement("li");
        typingDiv.classList.add("chat", "incoming", "typing-indicator");
        typingDiv.innerHTML = `
            <span class="bi bi-robot"></span>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        `;
        chatbox.appendChild(typingDiv);
        chatbox.scrollTo(0, chatbox.scrollHeight);
        
        // Remove indicador e mostra confirma√ß√£o
        setTimeout(() => {
            typingDiv.remove();
            
            chatbox.appendChild(createChatLi(
                `‚úÖ <strong>Conectando com ${option.department}...</strong><br>` +
                `Voc√™ ser√° redirecionado para o WhatsApp em instantes!<br><br>` +
                `<div class="whatsapp-redirect-info">` +
                `<i class="bi bi-whatsapp"></i> ` +
                `Aguardando redirecionamento...` +
                `</div>`,
                "incoming"
            ));
            chatbox.scrollTo(0, chatbox.scrollHeight);
            
            // Contador regressivo visual
            let countdown = 3;
            const countdownInterval = setInterval(() => {
                const redirectInfo = document.querySelector('.whatsapp-redirect-info');
                if (redirectInfo && countdown > 0) {
                    redirectInfo.innerHTML = `
                        <i class="bi bi-hourglass-split"></i> 
                        Redirecionando em ${countdown}...
                    `;
                    countdown--;
                } else {
                    clearInterval(countdownInterval);
                }
            }, 1000);
            
            // Abre o WhatsApp
            setTimeout(() => {
                const phoneNumber = "5547999998888"; // SUBSTITUA PELO SEU N√öMERO
                const encodedMessage = encodeURIComponent(option.message);
                window.open(`https://wa.me/${phoneNumber}?text=${encodedMessage}`, "_blank");
                
                // Feedback ap√≥s abertura
                setTimeout(() => {
                    chatbox.appendChild(createChatLi(
                        "üéâ WhatsApp aberto com sucesso!<br><br>" +
                        "Se o WhatsApp n√£o abriu automaticamente, " +
                        "<a href='https://wa.me/" + phoneNumber + "?text=" + encodedMessage + "' target='_blank' class='chat-link'>" +
                        "clique aqui</a>.",
                        "incoming"
                    ));
                    
                    setTimeout(() => {
                        chatbox.appendChild(createChatLi(
                            "Posso ajudar com algo mais?", 
                            "incoming"
                        ));
                        appendOptions();
                    }, 2000);
                }, 1000);
            }, 3000);
            
        }, 1500);
    }, 600);
}

    // Mostrar FAQ
    const showFAQ = () => {
        chatbox.appendChild(createChatLi(
            "‚ùì <strong>Perguntas Frequentes:</strong><br><br>" +
            "‚Ä¢ <strong>Frete:</strong> Gr√°tis acima de R$ 250<br>" +
            "‚Ä¢ <strong>Entrega:</strong> 5-10 dias √∫teis<br>" +
            "‚Ä¢ <strong>Pagamento:</strong> Cart√£o de Cr√©dito e PIX<br>" +
            "‚Ä¢ <strong>Troca:</strong> At√© 30 dias<br><br>" +
            "<a href='/contato' class='chat-link'>üìß Mais D√∫vidas? Entre em Contato</a>",
            "incoming"
        ));
        setTimeout(() => appendOptions(), 2000);
    }

    // Processar mensagem do usu√°rio
    const processUserMessage = (message) => {
        const msgLower = message.toLowerCase();
        
        // Busca por palavras-chave
        if (msgLower.includes("produto") || msgLower.includes("comprar") || msgLower.includes("pre√ßo")) {
            showProducts();
        } else if (msgLower.includes("pedido") || msgLower.includes("status") || msgLower.includes("entrega")) {
            showStatus();
        } else if (msgLower.includes("quiz") || msgLower.includes("teste") || msgLower.includes("recomend")) {
            showQuiz();
        } else if (msgLower.includes("humano") || msgLower.includes("atendente") || msgLower.includes("whatsapp")) {
            openWhatsApp();
        } else if (msgLower.includes("frete") || msgLower.includes("pagamento") || msgLower.includes("troca")) {
            showFAQ();
        } else {
            // Resposta padr√£o
            chatbox.appendChild(createChatLi(
                "Desculpe, n√£o entendi sua pergunta. üòÖ<br>Escolha uma das op√ß√µes abaixo ou reformule sua pergunta:",
                "incoming"
            ));
            setTimeout(() => appendOptions(), 800);
        }
    }

    // Toggle do Chat
    chatbotToggler.addEventListener("click", () => {
        document.body.classList.toggle("show-chatbot");
        if (document.body.classList.contains("show-chatbot")) {
            if (chatbox.querySelectorAll('.chat-options').length === 0) {
                setTimeout(appendOptions, 600);
            }
            // Foca no input quando abre
            setTimeout(() => chatInput.focus(), 700);
        }
    });

    // Envio de mensagem
    const handleChat = () => {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;
        
        chatInput.value = "";
        chatInput.style.height = "45px"; // Reseta altura
        
        // Remove op√ß√µes anteriores
        document.querySelectorAll('.chat-options').forEach(el => el.remove());
        
        chatbox.appendChild(createChatLi(userMessage, "outgoing"));
        chatbox.scrollTo(0, chatbox.scrollHeight);

        setTimeout(() => {
            processUserMessage(userMessage);
            chatbox.scrollTo(0, chatbox.scrollHeight);
        }, 600);
    }

    sendChatBtn.addEventListener("click", handleChat);
    
    chatInput.addEventListener("keydown", (e) => {
        if(e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            handleChat();
        }
    });

    // Auto-resize do textarea
    chatInput.addEventListener("input", () => {
        chatInput.style.height = "45px";
        chatInput.style.height = chatInput.scrollHeight + "px";
    });

    console.log("‚úÖ Chatbot Lumina carregado com sucesso!");
});

document.addEventListener('DOMContentLoaded', function() {
    
    // ==========================================
    // 1. ALERTAS FLUTUANTES (ADAPTADO)
    // ==========================================
    // O CSS e HTML j√° cuidam da parte visual.
    // O JS abaixo √© apenas para quando usamos AJAX (mostrarAlerta).

    

    // ==========================================
    // 3. MASCARAS DE INPUT (REUTILIZ√ÅVEL)
    // ==========================================
    
    // M√°scara de CEP
    const cepInputs = document.querySelectorAll('input[placeholder*="CEP"], input[placeholder*="00000"], input[id*="cep"]');
    cepInputs.forEach(input => {
        input.addEventListener('input', function(e) {
            let v = e.target.value.replace(/\D/g, '');
            v = v.replace(/^(\d{5})(\d)/, '$1-$2');
            e.target.value = v.slice(0, 9);
        });
    });

    // M√°scara de Telefone
    const phoneInputs = document.querySelectorAll('input[type="tel"]');
    phoneInputs.forEach(input => {
        input.addEventListener('input', function(e) {
            let v = e.target.value.replace(/\D/g, '');
            v = v.replace(/^(\d{2})(\d)/, '($1) $2');
            v = v.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = v.slice(0, 15);
        });
    });

    // ==========================================
    // 4. BLOQUEAR EXCLUS√ÉO DE CONTA PARA ADMIN
    // ==========================================
    
    const deleteAccountForm = document.querySelector('form[action*="excluir_conta"]');
    if (deleteAccountForm) {
        deleteAccountForm.addEventListener('submit', function(e) {
            // O bloqueia acontece no backend, mas podemos avisar no frontend
            const userRole = document.body.getAttribute('data-user-role') || 'cliente';
            if (userRole === 'admin') {
                alert('Administradores n√£o podem remover suas contas.');
                e.preventDefault();
            }
        });
    }

    // ==========================================
    // 5. HOVER DO BOT√ÉO PAGAMENTO
    // ==========================================
    
    const checkoutButtons = document.querySelectorAll('.btn-checkout, .pagamento-btn');
    checkoutButtons.forEach(btn => {
        if (btn.classList.contains('disabled') || btn.hasAttribute('disabled')) {
            btn.style.cursor = 'not-allowed';
            btn.style.opacity = '0.6';
        }
    });

});

// ==========================================
// ESC PARA DROPDOWN - VERS√ÉO CORRETA
// ==========================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('üîç Procurando dropdown do usu√°rio...');
    
    // M√©todo 1: Pelo ID (mais seguro)
    const toggleBtn = document.getElementById('navbarUserDropdown');
    
    if (!toggleBtn) {
        console.error('‚ùå Bot√£o dropdown n√£o encontrado pelo ID #navbarUserDropdown');
        // M√©todo 2: Pela classe espec√≠fica
        const toggleBtnAlt = document.querySelector('.navbar-right-cluster .dropdown-toggle');
        if (toggleBtnAlt) {
            console.log('‚úÖ Encontrado pelo seletor de classe:', toggleBtnAlt);
            setupDropdown(toggleBtnAlt);
        } else {
            console.error('‚ùå Bot√£o dropdown n√£o encontrado de nenhuma forma');
        }
        return;
    }
    
    console.log('‚úÖ Bot√£o encontrado:', toggleBtn);
    setupDropdown(toggleBtn);
});

function setupDropdown(toggleBtn) {
    // Encontra o menu dropdown (pr√≥ximo elemento irm√£o)
    const dropdownMenu = toggleBtn.nextElementSibling;
    
    if (!dropdownMenu || !dropdownMenu.classList.contains('dropdown-menu')) {
        console.error('‚ùå Menu dropdown n√£o encontrado pr√≥ximo ao bot√£o');
        return;
    }
    
    console.log('‚úÖ Menu encontrado:', dropdownMenu);
    
    // Remove o data-bs-toggle para evitar conflito com Bootstrap
    toggleBtn.removeAttribute('data-bs-toggle');
    
    // Vari√°vel para controlar estado
    let isOpen = false;
    
    // Fun√ß√£o para abrir dropdown
    function openDropdown() {
        console.log('üìÇ Abrindo dropdown');
        
        // Fecha outros dropdowns abertos
        document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
            menu.classList.remove('show');
            const btn = menu.previousElementSibling;
            if (btn && btn.classList.contains('dropdown-toggle')) {
                btn.setAttribute('aria-expanded', 'false');
            }
        });
        
        // Abre este dropdown
        dropdownMenu.classList.add('show');
        toggleBtn.setAttribute('aria-expanded', 'true');
        isOpen = true;
        
        // Foca no primeiro item
        setTimeout(() => {
            const firstItem = dropdownMenu.querySelector('a, button');
            if (firstItem) {
                firstItem.focus();
                console.log('üéØ Focado no primeiro item:', firstItem.textContent);
            }
        }, 100);
    }
    
    // Fun√ß√£o para fechar dropdown
    function closeDropdown() {
        console.log('üìÇ Fechando dropdown');
        dropdownMenu.classList.remove('show');
        toggleBtn.setAttribute('aria-expanded', 'false');
        isOpen = false;
    }
    
    // Fun√ß√£o para alternar
    function toggleDropdown() {
        console.log('üîÑ Alternando dropdown, estado atual:', isOpen ? 'aberto' : 'fechado');
        if (isOpen) {
            closeDropdown();
        } else {
            openDropdown();
        }
    }
    
    // 1. Clique no bot√£o (sobrescreve comportamento do Bootstrap)
    toggleBtn.addEventListener('click', function(e) {
        console.log('üñ±Ô∏è Clique detectado');
        e.preventDefault();
        e.stopImmediatePropagation(); // Importante: impede outros listeners
        toggleDropdown();
    }, true); // true = usa capturing phase para pegar antes do Bootstrap
    
    // 2. ESC para abrir/fechar
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            console.log('‚å®Ô∏è ESC pressionado');
            console.log('Elemento focado:', document.activeElement);
            console.log('Dropdown aberto?', isOpen);
            
            // Se dropdown est√° aberto, fecha
            if (isOpen) {
                console.log('üî¥ Fechando dropdown aberto');
                e.preventDefault();
                closeDropdown();
                toggleBtn.focus();
                return;
            }
            
            // Se o bot√£o dropdown est√° focado, abre
            if (document.activeElement === toggleBtn) {
                console.log('üü¢ Bot√£o focado - abrindo dropdown');
                e.preventDefault();
                openDropdown();
                return;
            }
            
            // Se est√° dentro do dropdown, fecha
            if (dropdownMenu.contains(document.activeElement)) {
                console.log('üî¥ Dentro do dropdown - fechando');
                e.preventDefault();
                closeDropdown();
                toggleBtn.focus();
                return;
            }
            
            // Se nenhum dos casos acima, tenta focar no bot√£o
            console.log('üü° Tentando focar no bot√£o dropdown...');
            
            // Verifica se o bot√£o est√° vis√≠vel
            const rect = toggleBtn.getBoundingClientRect();
            const isVisible = rect.width > 0 && rect.height > 0 &&
                             rect.top >= 0 &&
                             rect.left >= 0 &&
                             rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                             rect.right <= (window.innerWidth || document.documentElement.clientWidth);
            
            if (isVisible) {
                console.log('üéØ Bot√£o est√° vis√≠vel - focando...');
                toggleBtn.focus();
            } else {
                console.log('‚ö†Ô∏è Bot√£o n√£o est√° vis√≠vel na tela');
            }
        }
    }, true);
    
    // 3. Enter ou Espa√ßo
    toggleBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            console.log('‚å®Ô∏è Enter/Space no bot√£o');
            e.preventDefault();
            toggleDropdown();
        }
    }, true);
    
    // 4. Fecha ao clicar fora
    document.addEventListener('click', function(e) {
        if (isOpen && !toggleBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
            console.log('üñ±Ô∏è Clicando fora - fechando');
            closeDropdown();
        }
    });
    
    // 5. Fecha ao selecionar item
    dropdownMenu.querySelectorAll('a').forEach(item => {
        item.addEventListener('click', function() {
            console.log('üñ±Ô∏è Clicando em item - fechando');
            closeDropdown();
        });
    });
    
    // 6. Navega√ß√£o por teclado
    dropdownMenu.addEventListener('keydown', function(e) {
        const items = Array.from(this.querySelectorAll('a'));
        const currentIndex = items.indexOf(document.activeElement);
        
        switch(e.key) {
            case 'ArrowDown':
                e.preventDefault();
                if (currentIndex < items.length - 1) {
                    items[currentIndex + 1].focus();
                } else {
                    items[0].focus();
                }
                break;
                
            case 'ArrowUp':
                e.preventDefault();
                if (currentIndex > 0) {
                    items[currentIndex - 1].focus();
                } else {
                    items[items.length - 1].focus();
                }
                break;
                
            case 'Escape':
                e.preventDefault();
                closeDropdown();
                toggleBtn.focus();
                break;
                
            case 'Tab':
                if (e.shiftKey && currentIndex === 0) {
                    // Shift+Tab no primeiro item fecha
                    e.preventDefault();
                    closeDropdown();
                    toggleBtn.focus();
                } else if (!e.shiftKey && currentIndex === items.length - 1) {
                    // Tab no √∫ltimo item fecha
                    e.preventDefault();
                    closeDropdown();
                    // O pr√≥ximo elemento ser√° focado automaticamente pelo navegador
                }
                break;
        }
    });
    
    console.log('‚úÖ Dropdown configurado com sucesso!');
    console.log('üìã Instru√ß√µes:');
    console.log('1. Use TAB para focar no √≠cone da pessoa');
    console.log('2. Pressione ESC para abrir');
    console.log('3. Pressione ESC novamente para fechar');
    console.log('4. Use ‚Üë‚Üì para navegar dentro do menu');
    
    // Adiciona um indicador visual para ajudar
    toggleBtn.style.outline = '2px dashed #e8b8c2';
    toggleBtn.style.outlineOffset = '2px';
    
    // Remove ap√≥s alguns segundos
    setTimeout(() => {
        toggleBtn.style.outline = '';
    }, 5000);
}

// ==========================================
// 6. CARREGAR ALERTAS - FUN√á√ÉO AUXILIAR FLUTUANTE
// ==========================================

function mostrarAlerta(mensagem, tipo = 'info') {
    // Agora buscamos o container flutuante
    const targetContainer = document.getElementById('flash-overlay-container');
    
    // Fallback se n√£o existir o container flutuante (o que n√£o deve acontecer)
    if (!targetContainer) {
        const fallbackContainer = document.querySelector('.container');
        if (fallbackContainer) {
             const alertDiv = document.createElement('div');
             alertDiv.className = `alert alert-${tipo} alert-dismissible fade show`;
             alertDiv.innerHTML = `${mensagem}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
             fallbackContainer.insertBefore(alertDiv, fallbackContainer.firstChild);
        }
        return;
    }
}




document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('flash-overlay-container');
    const alerts = container.querySelectorAll('.alert-floating');
    
    alerts.forEach(alertDiv => {
        // Adicionar barra de progresso
        const progressBar = document.createElement('div');
        progressBar.className = 'alert-progress-bar';
        alertDiv.appendChild(progressBar);
        
        // Bot√£o de fechar
        const btnClose = alertDiv.querySelector('.btn-close');
        if (btnClose) {
            btnClose.addEventListener('click', function() {
                fecharAlerta(alertDiv);
            });
        }
        
        // Auto-fechar ap√≥s 5 segundos
        setTimeout(() => {
            if (alertDiv.parentElement) {
                fecharAlerta(alertDiv);
            }
        }, 5000);
    });
    
    function fecharAlerta(alertDiv) {
        alertDiv.classList.add('closing');
        setTimeout(() => {
            alertDiv.remove();
        }, 500);
    }
});

    

    </script>
    
    {% block scripts %}{% endblock %}

</body>
</html>